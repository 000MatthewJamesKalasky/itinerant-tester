group: travis_latest
os: linux
dist: focal
language: python
cache: pip
python:
  #- 2.7
  #- 3.5
  #- 3.6
  #- 3.7
  #- 3.8
  - 3.9-dev
jobs:
  allow_failures:
    - python: 2.7
    - python: nightly
    - python: pypy
    - python: pypy3
env:
  - REPO=internetarchive/acs4_py      # 2020-01-22
  - REPO=internetarchive/analyze_ocr  # 2011-11-30 mikemccabe/analyze_ocr
  - REPO=mikemccabe/analyze_ocr
  - REPO=internetarchive/archive-analysis  # 2016-07-12 vinaygoel/archive-analysis
  - REPO=vinaygoel/archive-analysis
  - REPO=internetarchive/autocrop     # 2013-04-25 rajbot/autocrop
  - REPO=rajbot/autocrop
  - REPO=internetarchive/bookserver   # 2018-11-01
  - REPO=internetarchive/brozzler     # 2020-08-15
  - REPO=internetarchive/btget        # 2011-07-26
  - REPO=internetarchive/CDX-Writer   # 2020-05-20 rajbot/CDX-Writer
  - REPO=rajbot/CDX-Writer
  - REPO=internetarchive/crawling-for-nomore404  # 2020-07-16
  - REPO=internetarchive/doublethink  # 2019-05-17
  - REPO=internetarchive/draintasker  # 2020-08-13
  - REPO=internetarchive/dweb-gateway  # 2020-01-04
  - REPO=internetarchive/dwebsummit-site-2  # 2020-06-05
  - REPO=internetarchive/epub         # 2016-01-18
  - REPO=internetarchive/epub3        # 2019-12-05 deborahgu/abbyy-to-epub3
  - REPO=deborahgu/abbyy-to-epub3
  - REPO=internetarchive/eventer      # 2011-06-01
  - REPO=internetarchive/fatcat       # 2020-08-05
  - REPO=internetarchive/IA-solr-frontend  # 2012-04-05
  - REPO=internetarchive/ias3         # 2010-03-25
  - REPO=internetarchive/IAWatchBot   # 2012-03-26 dmontalvo/IAWatchBot
  - REPO=dmontalvo/IAWatchBot
  - REPO=internetarchive/infogami     # 2020-08-25 infogami/infogami
  - REPO=infogami/infogami
  - REPO=internetarchive/liveweb      # 2019-10-22
  - REPO=internetarchive/maisy        # 2011-07-08
  - REPO=internetarchive/map-of-the-web  # 2018-08-17
  - REPO=internetarchive/maxmind-geoip  # 2011-10-11 jlopez/maxmind-geoip
  - REPO=jlopez/maxmind-geoip
  - REPO=internetarchive/openlibrary  # 2020-08-27
  - REPO=internetarchive/openlibrary-bots  # 2020-08-27
  - REPO=internetarchive/openlibrary-client  # 2020-08-27
  - REPO=internetarchive/pdf_trio     # 2020-06-11 tralfamadude/pdf_trio
  - REPO=tralfamadude/pdf_trio
  - REPO=internetarchive/pig          # 2013-06-04
  - REPO=internetarchive/poppler-ia   # 2009-11-25
  - REPO=internetarchive/py-wasapi-client  # 2017-09-22 unt-libraries/py-wasapi-client
  - REPO=unt-libraries/py-wasapi-client
  - REPO=internetarchive/rulesengine  # 2020-06-05
  - REPO=internetarchive/rulesengine-client  # 2019-10-18
  - REPO=internetarchive/s3_loader    # 2013-02-05
  - REPO=internetarchive/scrapy-warcio  # 2019-12-21
  - REPO=internetarchive/scribe-redux  # 2016-09-22
  - REPO=internetarchive/snakebite-py3  # 2020-05-20
  - REPO=internetarchive/surt         # 2020-02-14 rajbot/surt
  - REPO=rajbot/surt
  - REPO=internetarchive/trough       # 2020-08-27
  - REPO=internetarchive/tvnews       # 2020-08-21 MaxReinisch/tvnews
  - REPO=MaxReinisch/tvnews
  - REPO=internetarchive/ultrajson    # 2019-11-04 ultrajson/ultrajson
  - REPO=ultrajson/ultrajson
  - REPO=internetarchive/umbra        # 2020-04-25
  - REPO=internetarchive/waimea       # 2013-06-05
  - REPO=internetarchive/warc         # 2018-04-20
  - REPO=internetarchive/warcprox     # 2020-08-20
  - REPO=internetarchive/warctools    # 2019-12-11
  - REPO=internetarchive/wayback-discover-diff  # 2020-01-14 ftsalamp/wayback-discover-diff
  - REPO=ftsalamp/wayback-discover-diff
  - REPO=internetarchive/wmd          # 2020-04-27 derobins/wmd
  - REPO=derobins/wmd
install:
  #- pip install -r requirements.txt
  - pip install codespell flake8  # pytest  # add other testing frameworks later
before_script:
  - URL=https://github.com/${REPO}
  - echo ; echo -n "flake8 testing of ${URL} on " ; python -V
  - git clone --depth=50 ${URL} ~/${REPO}  # --branch=master
  - cd ~/${REPO}
script:
  - echo stop the build if there are Python syntax errors or undefined names
  - echo ; echo -n "flake8 testing of ${URL} on " ; python -V
  - time flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
  - echo exit-zero treats all errors as warnings.  The GitHub editor is 127 chars wide
  - flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics
  - codespell . --ignore-words-list=ba,referer --skip=./.* --quiet-level=2 || true
  #- true  # pytest --capture=sys
notifications:
  on_success: change
  on_failure: change  # `always` will be the setting once code changes slow down
