# https://github.com/actions/setup-python/blob/main/docs/advanced-usage.md#using-the-python-version-file-input
# https://raw.githubusercontent.com/actions/python-versions/main/versions-manifest.json
name: python_version_file
on: [pull_request, push]
jobs:
  python_version_file:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Read the Python version from Makefile.envs
        shell: python
        run: |
          from pathlib import Path
          python_version = "PYVERSION not found!"
          # Looking for the line: "export PYVERSION ?= 3.11.1"
          for line in Path("Makefile.envs").read_text():
              parts = line.split()
              if parts[1] == "":
                  python_version = parts[3]
                  break
          # Write an ephemeral file because GitHub Actions do not write back changes
          Path("python-version").write_text(python_version)
      - uses: actions/setup-python@v4
        with:
          python-version-file: "python-version"
      - shell: python
        run: import sys ; print(sys.version)
